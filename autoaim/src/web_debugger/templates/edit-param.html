<!DOCTYPE html>
<html>

<head>
    <title>å‚æ•°ç¼–è¾‘å™¨</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/edit-param.css') }}">

    <!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/default.min.css"> -->
    <script src="{{ url_for('static', filename='js/highlight.min.js') }}"></script>
    <script>hljs.highlightAll();</script>
</head>

<body>
    <h1>å‚æ•°ç¼–è¾‘å™¨</h1>
    <span><b>ä¿®æ”¹æ—¶æ³¨æ„ï¼Œæ•°æ®ç±»å‹ä¸èƒ½å˜å—·ï¼æ¯”å¦‚ <code>2.0</code> ä¸èƒ½æ”¹æˆ <code>2</code>. æ”¹å®Œè®°å¾—æŒ‰å³è¾¹æ›´æ–°æŒ‰é’®æ‰ä¼šæ›´æ–° ğŸ‘‡ğŸ»ï¼</b></span>
    <div class="container">
        <div class="left-column">
            <pre>
            <code id="new-data" name="new-data" contenteditable="true">{{ data }}</code>
            </pre>
        </div>
        <div class="right-column">
            <button type="button" onclick="update_param()" style="padding: 10px;">æ›´æ–°å‚æ•° - ä¸ç‚¹ä¸æ›´</button>
            <br>

            <textarea id="feedback-log" name="feedback-log" rows="30" cols="80" class="code-like"></textarea>
        </div>

    </div>

    <script>
        document.getElementById("feedback-log").value = 'å¦‚æœè¯•å›¾æ›´æ–°å‚æ•°åï¼Œæ­¤å¤„æ²¡æœ‰ä»»ä½•åé¦ˆï¼Œåˆ™æ›´æ–°å¯èƒ½å¤±è´¥äº†ã€‚\n'

        {
            var update_cnt = 0;
            function update_param() {
                update_cnt += 1;
                var new_data = document.getElementById("new-data").innerText;
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/edit-param/post", true);
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xhr.onreadystatechange = function () {
                    var feedback = document.getElementById("feedback-log");
                    if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                        feedback.value += '[INFO] @edit-param.html: æˆåŠŸå‘é€äº†ç¬¬ ' + String(update_cnt) + ' æ¬¡æ–‡ä»¶æ›´æ–°è¯·æ±‚ã€‚\n';
                        feedback.scrollTop = feedback.scrollHeight;
                    }
                };
                xhr.send("new-data=" + encodeURIComponent(new_data));
            }

            document.addEventListener('keydown', function (event) {
                if ((event.ctrlKey || event.metaKey) && event.key == 's') {
                    event.preventDefault();
                    hljs.highlightAll();
                    update_param();
                }
            });
        }

        // var source = new EventSource('/edit-param/poll-log');
        // source.onmessage = function (event) {
        //     var feedback = document.getElementById("feedback-log");
        //     feedback.value += event.data + '\n';
        //     feedback.scrollTop = feedback.scrollHeight;
        // }
    </script>

</body>

</html>